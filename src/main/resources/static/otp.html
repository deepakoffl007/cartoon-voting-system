<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OTP Verification</title>
<link rel="icon" href="otp.jpg">
<style>
  body { font-family: Inter, Arial; background: linear-gradient(135deg,#f6d365,#fda085);
    height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; }
  .card { background:#fff; padding:28px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.12); width:360px; text-align:center; }
  input, button { width:100%; padding:10px; margin-top:10px; border-radius:8px; border:1px solid #ddd; font-size:15px; }
  button { background:#e67e22; color:white; border:none; cursor:pointer; }
  .muted { font-size:13px; color:#666; margin-top:8px; }
</style>
</head>
<body>
  <div class="card">
    <h2>Enter OTP</h2>
    <input id="otp" placeholder="Enter OTP" />
    <button onclick="verifyOtp()">Verify</button>
    <div id="info" class="muted"></div>
  </div>

<script>
const backend = "https://cartoon-voting-system.onrender.com";

async function verifyOtp(){
  const email = localStorage.getItem('email');
  const otp = document.getElementById('otp').value.trim();
  const info = document.getElementById('info');
  if(!otp){ info.innerText='Enter OTP'; info.style.color='red'; return; }
  info.innerText='Verifying...';
  try{
    const res = await fetch(`${backend}/auth/verify-otp?email=${encodeURIComponent(email)}&otp=${encodeURIComponent(otp)}`, { method:"POST" });
    const data = await res.json();
    if(data.status === "ok"){
      localStorage.setItem("token", data.token);
      localStorage.setItem("isAdmin", data.isAdmin ? "true" : "false");
      info.innerText='Verified. Redirecting...';
      setTimeout(()=> location.href='vote.html', 800);
    } else {
      info.innerText = data.message;
      info.style.color='red';
    }
  }catch(e){ info.innerText='Error: '+e.message; }
}
</script>
</body>
</html>
