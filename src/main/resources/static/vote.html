<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Vote</title>
<link rel="icon" href="vote.jpg">
<style>
  body { background: #f0f0f0; font-family: Inter; margin: 0; }
  .container { max-width: 800px; margin: 40px auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align:center; }
  img { width: 100%; border-radius: 10px; }
  button { background: #1e90ff; color: white; border: none; border-radius: 6px; padding: 10px 20px; cursor:pointer; }
  .message { margin-top:10px; font-weight:500; }
</style>
</head>
<body>
<div class="container">
  <h1>Vote for Your Favorite Cartoon</h1>
  <div style="display:flex;gap:20px;justify-content:center;">
    <div><img src="pokemon.jpeg" alt="Pokemon"><br><button onclick="vote('POKEMON')">Vote Pokemon</button></div>
    <div><img src="doreamon.jpeg" alt="Doraemon"><br><button onclick="vote('DORAEMON')">Vote Doraemon</button></div>
  </div>
  <br>
  <button onclick="sendAdminOtp()">View Results (Admins only)</button>
  <div id="msg" class="message"></div>
</div>

<script>
const backend = "https://cartoon-voting-system.onrender.com";
const token = localStorage.getItem('token');

async function vote(candidate){
  const msg = document.getElementById('msg');
  msg.innerText = "Submitting...";
  try {
    const res = await fetch(`${backend}/auth/vote?token=${token}&candidate=${candidate}`, { method:"POST" });
    const data = await res.json();
    msg.innerText = data.message;
    msg.style.color = data.status === "ok" ? "green" : "red";
  } catch(e){ msg.innerText='Error: '+e.message; }
}

async function sendAdminOtp(){
  const msg = document.getElementById('msg');
  msg.innerText = "Requesting Admin OTPs...";
  try {
    const res = await fetch(`${backend}/auth/send-admin-otp`, { method:"POST" });
    const data = await res.json();
    if(data.status === "ok") {
      msg.innerText = "OTP sent to admins. Redirecting...";
      setTimeout(()=> location.href='admin-otp.html', 800);
    } else msg.innerText = data.message;
  } catch(e){ msg.innerText='Error: '+e.message; }
}
</script>
</body>
</html>
